<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="generator" content="Jekyll v3.3.1">

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Autonomous Collective Systems Laboratory" />
		<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Beginning to Program Pheeno - Autonomous Collective Systems Laboratory</title>
<meta property="og:title" content="Beginning to Program Pheeno" />
<meta name="description" content="" />
<meta property="og:description" content="" />
<link rel="canonical" href="http://localhost:4000/pheeno/pheeno_programming_content/" />
<meta property="og:url" content="http://localhost:4000/pheeno/pheeno_programming_content/" />
<meta property="og:site_name" content="Autonomous Collective Systems Laboratory" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-06-12T22:22:13-04:00" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Beginning to Program Pheeno",
    "datePublished": "2017-06-12T22:22:13-04:00",
    "description": "",
    "logo": "http://localhost:4000/siteicon.png",
    "url": "http://localhost:4000/pheeno/pheeno_programming_content/"
  }
</script>
<!-- End Jekyll SEO tag -->

		
        
        
	</head>

	<body>
		<header>
			<h1>
				<a href="/"><img src="/images/emblem.svg" width="40" height="40" alt="Autonomous Collective Systems Laboratory logo"></a>
				Autonomous Collective Systems Laboratory
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Welcome</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/ROS/pheeno-ros-installation-guide/">ROS</a>
							<ul>
								
									<li class="nav-item "><a href="/ROS/pheeno-ros-installation-guide/">ROS Installation for Pheeno</a></li>
								
									<li class="nav-item "><a href="/ROS/pheeno-ros-guide/">pheeno_ros ROS Package Guide</a></li>
								
									<li class="nav-item "><a href="/ROS/pheeno-ros-server-guide/">pheeno_ros_server ROS Package Guide</a></li>
								
									<li class="nav-item "><a href="/ROS/pheeno-ros-sim-guide/">pheeno_ros_sim ROS Package Guide</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/controls/pheeno-controller-guide/">Controls</a>
							<ul>
								
									<li class="nav-item "><a href="/controls/pheeno-controller-guide/">Controller for Pheeno Navigation</a></li>
								
									<li class="nav-item "><a href="/controls/pheeno-observer-guide/">Using Pheeno's for Reliable Feedback</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/pheeno/pheeno_construction_content/">Pheeno</a>
							<ul>
								
									<li class="nav-item "><a href="/pheeno/pheeno_construction_content/">Pheeno Construction Guide</a></li>
								
									<li class="nav-item "><a href="/pheeno/raspberry_pi_content/">Setting Up Raspberry Pi with Camera for Pheeno</a></li>
								
									<li class="nav-item "><a href="/pheeno/pheeno_software_installation/">Pheeno Software Installation</a></li>
								
									<li class="nav-item current"><a href="/pheeno/pheeno_programming_content/">Beginning to Program Pheeno</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Pheeno</h2>
				<h3>Beginning to Program Pheeno</h3>
			</div>
			<article class="content">
				<!-- The Prettify Code -->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=cpp&amp;"></script>

<p>One of the processors on board the Pheeno robotic platform is the Arduino Pro Mini with the ATMega328 (3.3V, 8MHz) processor. This section of the guide will introduce how the sensors and motors on the robot are controlled by this processor. It will also walk you through small codes to make the robot move around and sense its environment.</p>

<p>This guide will focus heavily on premade libraries and code available on the <a href="https://github.com/ACSLab/PheenoRobot/">GitHub</a> repository for Pheeno. These codes and libraries are not necessary for the operation of Pheeno in the long run but do allow for easier coding with subroutines for making the robot drive around using open and closed loop control. If you are new to Arduino programming and general electronics, the <a href="pheeno_programming_content#general-pin-information-for-connection-between-the-arduino-and-motors-and-sensors">next</a> section may not be very informative and can be skimmed over. If you are experienced in Arduino coding, the <a href="pheeno_programming_content#getting-started">next</a> section gives details on how the sensors and motors are connected to the Arduino so you can develop your own scripts. If you run into issues with programming the Arduino, there are plenty of resources available at the <a href="https://forum.arduino.cc/">Arduino Forums</a> and specifically on the <a href="https://www.arduino.cc/en/Guide/ArduinoProMini/">Arduino Pro Mini</a>. Of course, always feel free to contact the e-mail above with any questions or issues!</p>

<h2 id="general-pin-information-for-connection-between-the-arduino-and-motors-and-sensors">General Pin Information for Connection between the Arduino and Motors and Sensors</h2>
<p>If you want to create your own code and bypass the premade libraries this section will explain briefly how Pheeno’s sensors and motors are connected to the Arduino! <em>Table 1</em> gives a general overview of how the pins of the Arduino Pro Mini are connected to the various sensors and actuators.</p>

<style>
caption {
    font-size: 20px;
}
</style>

<table>
    <tr>
        <th>Component</th>
        <th>Connected Pins</th>
        <th>Pin Type</th>
    </tr>
    <tr>
        <td> Left IR Range Sensor </td>
        <td> A2 </td>
        <td> Analog </td>
    </tr>
    <tr>
        <td> Left Forward IR Range Sensor </td>
        <td> A1 </td>
        <td> Analog </td>
    </tr>
    <tr>
        <td> Center IR Range Sensor </td>
        <td> A0 </td>
        <td> Analog </td>
    </tr>
    <tr>
        <td> Right Forward IR Range Sensor </td>
        <td> A6 </td>
        <td> Analog </td>
    </tr>
    <tr>
        <td> Right IR Range Sensor </td>
        <td> A7 </td>
        <td> Analog </td>
    </tr>
    <tr>
        <td> Back IR Range Sensor </td>
        <td> A3 </td>
        <td> Analog </td>
    </tr>
    <tr>
        <td> LSM303D (Accelerometer/Magnetometer) </td>
        <td> A4, A5 </td>
        <td> SDA, SCL </td>
    </tr>
    <tr>
        <td> Left Encoder </td>
        <td> 3, 12 </td>
        <td> Digital Interrupt, Digital </td>
    </tr>
    <tr>
        <td> Right Encoder </td>
        <td> 2, 13 </td>
        <td> Digital Interrupt, Digital </td>
    </tr>
    <tr>
        <td> Left Motor </td>
        <td> 5, 6, 7 </td>
        <td> Digital PWN, Digital, Digital </td>
    </tr>
    <tr>
        <td> Right Motor </td>
        <td> 11, 9, 10 </td>
        <td> Digital PWM, Digital, Digital </td>
    </tr>
    <tr>
        <td> Camera Servo </td>
        <td> 4 </td>
        <td> Digital </td>
    </tr>
    <caption><i><strong>Table 1:</strong> Pheeno's component connections to the Arduino Pro Mini.</i></caption>
</table>

<p>The IR range sensor data is relatively straight forward. The analog voltage input is taken in through the 10 bit ADC converter measured from ground to VCC. The conversion from voltage to distance is fairly linear until the extremes of the sensor. An example conversion can be found in the readIR function of Pheeno.cpp. This conversion was found experimentally so feel free to find your own conversion if you find it is too inaccurate.</p>

<p>The LSM303D is a board within Pheeno that contains an accelerometer and magnetometer. It sends data to the Arduino through I2C communication. Some example files on how this communication is done are in the LSM303D library. Additional information can be found through a supplier of the board, <a href="https://www.pololu.com/product/2127">Pololu</a>.</p>

<p>The left and right encoders make use of the external interrupt pins available on the Arduino Pro Mini. These encoders can be used as normal encoders with 6 counts per revolution only using the sensors connected to the interrupt pins. They can also be used as quadrature encoders using both sets of pins. The encoder library supplied is highly recommended for quadrature encoder use.</p>

<p>The left and right motor are controlled using PWM control for a pseudo analog signal and a H-bridge motor board to control the direction. Pins 6 and 7, for the left motor, and 9 and 10, for the right motor, may be driven to opposite voltages (HIGH and LOW) to determine the direction of motion or both HIGH to “short” the motor providing a brake. Pins 5 and 11 are PWM pins that determine the speed the motor.  The Arduino uses a range of 0-255 to regulate the duty cycle of the PWM signal. Subroutines forwardL, forwardR, reverseL, reverseR, brake, and noMotion in the provided Pheeno arduino library (Pheeno.h, Pheeno.cpp) may be viewed as example motor functions.</p>

<p>The camera servo is controlled by pin 4. The servo library is highly recommended for its use.</p>

<h2 id="getting-started">Getting Started</h2>
<p>This section will give a brief introduction to installing the Arduino program to your computer, uploading a script to Pheeno, and installing the premade libraries onto your computer.</p>

<h3 id="installing-arduino">Installing Arduino</h3>
<p>If you do not have the Arduino software on your computer, first go to the <a href="https://www.arduino.cc/en/Main/Software">Arduino software download page</a>. Download the appropriate software for your operating system and install it!</p>

<h3 id="installing-the-pheeno-libraries">Installing the Pheeno Libraries</h3>
<p>To use the premade libraries for Pheeno you must first download the files and place them in the right place on your computer so the Arduino software can access them. From the <a href="https://github.com/ACSLab/PheenoRobot/">GitHub</a> repository for Pheeno download the Code folder. Inside this folder should be an Arduino subfolder with folders labeled Encoder, LSM303, and Pheeno. Copy those three folders to your <em>Documents/Arduino/libraries</em> folder. Now open the Arduino software. If all was done correctly, when you go to File –&gt; Examples, you should see Encoder, LSM303, and Pheeno at the bottom (you may have to scroll down if you have a lot of arduino libraries already)! If this does not work or the above instructions are unclear, it is recommended to look through the <a href="https://www.arduino.cc/en/Guide/Libraries/">Arduino Library Guide</a>.</p>

<h3 id="uploading-your-first-script">Uploading Your First Script</h3>
<p>There should be a USB chord coming out from the Pheeno robot to the Raspberry Pi. This chord allows for serial communication between the Raspberry Pi and the Arduino (and the programming of the Arduino from the Raspberry Pi but this will be explored later). This USB chord can also be used to program the Arduino Pro Mini directly from your computer. Plug the USB into your computer and allow the drivers to install. Once the drivers have installed, open the Arduino software. Go to the Tools tab of the Arduino software and change the board to the Arduino Pro or Pro Mini as seen in Figure <a href="pheeno_programming_content#fig1a">1a</a>.</p>

<figure id="fig1a">
    <center>
        <img src="http://localhost:4000/images/programming/ArduinoChangeBoard.jpg" width="450px" height="500px" />
        <figcaption>(a) Changing the Board of the Arduino software.</figcaption>
    </center>
</figure>

<figure id="fig1b">
    <center>
        <img src="http://localhost:4000/images/programming/ArduinoChangeProcessor.jpg" width="450px" height="500px" />
        <figcaption>(b) Changing the processor of the Arduino software.</figcaption>
    </center>
</figure>

<figure id="fig1c">
    <center>
        <img src="http://localhost:4000/images/programming/ArduinoChangePort.jpg" width="450" height="500" />
        <figcaption>(c) Changing the port of the Arduino software.</figcaption>
    </center>
</figure>

<figure id="fig1d">
    <center>
        <img src="http://localhost:4000/images/programming/ArduinoUpload.jpg" width="450" height="500" />
        <figcaption>(d) Uploading a script to Pheeno.</figcaption>
    </center>
</figure>
<p><strong><em>Figure 1:</em></strong> <em>Steps to upload an Arduino script to Pheeno.</em></p>

<p>Next, go to the Tools tab of the Arduino software and change the processor to the ATMega328 (3.3V, 8MHz) as seen in Figure <a href="pheeno_programming_content#fig1b">1(b)</a>.</p>

<p>Finally, go to the Tools tab of the Arduino software and change the port to the one that the robot is plugged into. Typically there should only be one unless you have another USB device that uses serial communication connected. An example can be seen in Figure <a href="pheeno_programming_content#fig1c">1(c)</a>. <font color="red">NOTE: The number associated with the port may not be the same!</font></p>

<p>Now the Arduino software knows what type of board to talk to and through what port. So now you can upload any code you want! To test this all out let’s upload an example script that will be explained later. Go to <em>File</em> –&gt; <em>Examples</em> –&gt; <em>Pheeno</em> –&gt; <em>RandomWalkObstacleAvoidExample</em>. This should load a premade script if you have done everything in <a href="pheeno_programming_content#installing-the-pheeno-libraries">“Installing the Pheeno Libraries”</a> section correctly. Now click the arrow in the upper left hand corner of the Arduino software to upload it to the robot. <font color="red">NOTE: THIS SCRI#PT MAKES PHEENO RUN AROUND RANDOMLY! MAKE SURE YOU'RE HOLDING THE PLATFORM SO IT DOESN'T RUN OFF THE TABLE OR MAKE SURE THE ROBOT IS OFF WHILE UPLOADING!</font> When the Arduino software says “Done uploading”, as seen in Figure <a href="pheeno_programming_content#fig1d">1(d)</a>, you can disconnect the robot and let it run around.</p>

<h2 id="pheeno-arduino-library-functions">Pheeno Arduino Library Functions</h2>
<p>If you plan on using the Pheeno library for the Arduino, you can take advantage of some premade functions! This section details what they do and what inputs they take briefly! To use the Pheeno library in any Arduino script, you must first include the necessary libraries shown below!</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="n">include</span> <span class="s">"Pheeno.h"</span>
<span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre>
</div>

<p>This allows you to use all of the premade functions defined in Pheeno.h and Pheeno.cpp. The Pheeno file that is imported is a premade class. To initialize this class properly you must declare it like is done in the second line of the code above (Pheeno myRobot = Pheeno(1);). Here the class has been named myRobot, but it can be called whatever you would like when creating your own code. From this point onwards it will be assumed this instance of the class will be named myRobot.</p>

<h3 id="myrobotsetup">myRobot.SETUP()</h3>
<p>In the setup section of the Arduino you should include Pheeno.Setup. This function initializes all of the pins on the Arduino correctly and begins certain timers for controllers.</p>

<h3 id="sensor-reading-functions">Sensor Reading Functions</h3>
<h4 id="myrobotreadir">myRobot.readIR()</h4>
<p>This function takes a reading from all 6 of the IR sensors and converts the measurement to cm. These values are stored in the following variables.</p>

<ul>
  <li><strong>myRobot.LDistance</strong>	 (The distance received by the Left IR.)</li>
  <li><strong>myRobot.LFDistance</strong> (The distance received by the Left Forward IR.)</li>
  <li><strong>myRobot.CDistance</strong>	 (The distance received by the Center IR.)</li>
  <li><strong>myRobot.RFDistance</strong> (The distance received by the Right Forward IR.)</li>
  <li><strong>myRobot.RDistance</strong>	 (The distance received by the Right IR.)</li>
  <li><strong>myRobot.BDistance</strong>	 (The distance received by the Back IR.)</li>
</ul>

<h4 id="readencoders">readEncoders()</h4>
<p>This function returns the current count for the right and left encoder. This subroutine uses the Encoder.h library provided. More information on this library can be found <a href="http://www.pjrc.com/teensy/td_libs_Encoder.html">here</a>. These counts are stored in the variables,</p>

<ul>
  <li><strong>myRobot.encoderCountL</strong>	(The count of the left encoder.)</li>
  <li><strong>myRobot.encoderCountR</strong>	(The count of the right encoder.)</li>
</ul>

<h4 id="pheenoreadcompassfloat-magnorthoffset">Pheeno.readCompass(float magNorthOffset)</h4>
<p>This function returns the current heading in degrees from magnetic north in a range of 0° to 359°. The measurement is done with respect to Pheeno’s x-axis as defined in Figure <a href="pheeno_programming_content#fig2">2</a>. Positive rotation is CCW. The argument given allows the user to input the difference between magnetic north and their desired axis. This allows the function to return the robot’s heading with respect to a given axis. If an argument of <em>0</em> is given, the function will return Pheeno’s heading with respect to magnetic north. If an argument of 10 is given, the function will return Pheeno’s heading with respect to an axis 10 degrees CCW of magnetic north. The output is stored in the variable,</p>

<ul>
  <li><strong>myRobot.IMUOrientation</strong></li>
</ul>

<figure id="fig2">
    <center>
        <img src="http://localhost:4000/images/programming/accelAxis.jpg" width="500" height="500" />
    </center>
</figure>
<p><strong><em>Figure 2:</em></strong> <em>The axis of the IMU on Pheeno.</em></p>

<h4 id="pheenoreadaccel">Pheeno.readAccel()</h4>
<p>This function returns the accelerometer readings in the x, y, and z directions. These axis with respect to the robot may be seen in Figure <a href="pheeno_programming_content#fig2">2</a>. The sensor’s measurements are output in cm/s. The output is stored in the variables,</p>

<ul>
  <li><strong>myRobot.IMUACCX</strong> (The acceleration in the x direction.)</li>
  <li><strong>myRobot.IMUACCY</strong> (The acceleration in the y direction.)</li>
  <li><strong>myRobot.IMUACCZ</strong> (The acceleration in the z direction.)</li>
</ul>

<h3 id="position-update-functions">Position Update Functions</h3>
<h4 id="pheenoencoderpositionupdatefloat-timestep">Pheeno.encoderPositionUpdate(float timeStep)</h4>
<p>This is a function that figures out where Pheeno is in space using only the encoder measurements as feedback. The function requires, as input, the time between function calls to calculate how far it has gone in that time. The update is based on the unicycle model (a kinematic model) and will accumulate error over time due to unavoidable wheel slipping and assumption errors from the model.</p>

<h4 id="pheenosensorfusionpositionupdatefloat-timestep-float-northoffset">Pheeno.sensorFusionPositionUpdate(float timeStep, float northOffset)</h4>
<p>This is a function that figures out where Pheeno is in space using all of the onboard odometry. The update is based on the unicycle model (a kinematic model). Using a complementary filter, the magnetometer and encoder measurements are used to determine Pheeno’s global orientation and the accelerometer and encoders are used to determine Pheeno’s linear displacement. The encoder measurements are high pass filtered in this function while the accelerometer and compass measurements are low pass filtered. The gains for this filter can be altered in the <em>Pheeno.cpp</em> file. This function requires the time step between function calls (for the encoder estimate updates) and the offset between magnetic north and a desired axis (if the user requires).</p>

<h3 id="individual-motor-functions">Individual Motor Functions</h3>
<p>The input of all the following functions, motorSpeed, is a in arduino PWM units which are integers ranging from 0-255. 0 means no motion while 255 is as fast as it can go. These are all open loop. It is advised to put controllers over these. One is provided below!</p>

<ul>
  <li><strong>myRobot.forwardL(int motorSpeed):</strong> Rotates the left motor forward.</li>
  <li><strong>myRobot.forwardR(int motorSpeed):</strong> Rotates the right motor forward.</li>
  <li><strong>myRobot.reverseL(int motorSpeed):</strong> Rotates the left motor backwards.</li>
  <li><strong>myRobot.reverseR(int motorSpeed):</strong> Rotates the right motor backward</li>
</ul>

<h3 id="dual-motor-functions">Dual Motor Functions</h3>
<p>The input of all the following functions, motorSpeed, is a in arduino PWM units which are integers ranging from 0-255. 0 means no motion while 255 is as fast as it can go. These are all open loop. Due to individual differences in the motors, construction of the robot, or the environment there could be errors in the desired motion (i.e. forward will not drive perfectly straight).</p>

<ul>
  <li><strong>myRobot.forward(int motorSpeed):</strong> Rotates both motors forwards at the same speed.</li>
  <li><strong>myRobot.reverse(int motorSpeed):</strong> Rotates both motors backwards at the same speed.</li>
  <li><strong>myRobot.turnRight(int motorSpeed):</strong> Rotates both motors in opposite directions at the same speed such that Pheeno rotates to its right (clockwise).</li>
  <li><strong>myRobot.turnLeft(int motorSpeed):</strong>  Rotates both motors in opposite directions at the same speed such that Pheeno rotates to its left (counter clockwise).</li>
</ul>

<h3 id="stopping-functions">Stopping Functions</h3>

<ul>
  <li><strong>Pheeno.noMotion():</strong> Stops the motion of both motors but still allows passive rotation.</li>
  <li><strong>Pheeno.brake():</strong> Brakes both motors which does not allow passive rotation (this can be overcome with enough torque).</li>
</ul>

<h3 id="controller-functions">Controller Functions</h3>
<h4 id="pidmotorcontrolfloat-deslvel-float-desrvel">PIDMotorControl(float desLVel, float desRVel)</h4>
<p>This is a standard PID controller that maintains the speed of the left and right motors. The inputs are the desired right and left wheel angular velocities in rad/s. The controller has been designed around a 0.05 second time step. The gains of the system can be changed in the Pheeno.cpp file if so desired.</p>

<h4 id="pidwaypointcontrolfloat-u1-float-u2-float-desvelocity-float-timestep">PIDWayPointControl(float u1, float u2, float desVelocity, float timeStep)</h4>
<p>This is a standard PID controller moves Pheeno from its current location to a new desired location. The PID controller maintains Pheeno’s heading in the correct direction while driving at a desired velocity. The inputs are the desired global X-Position (cm), desired global Y-Position (cm), desired linear velocity (cm/s), and the time step (ms) of the controller. The controller has been designed around a 0.1 second time step. The gains of the system can be changed in the Pheeno.cpp file.</p>

<h4 id="rotateabouticcfloat-r-float-wspeed">rotateAboutICC(float R, float WSpeed)</h4>
<p>This function drives Pheeno in a circle of a given radius at a desired angular speed. The inputs of the function are R the radius of the desired circle (cm), WSpeed (rad/s) the desired angular speed the circle is traversed. The function uses the PIDMotorControl function described in <a href="pheeno_programming_content#pidmotorcontrolfloat-deslvel-float-desrvel">PIDMotorControl</a> section.</p>

<h2 id="calibrating-pheenos-imu">Calibrating Pheeno’s IMU</h2>
<h3 id="manual-calibration">Manual Calibration</h3>
<p>For manual calibration open the script ManualValuesIMU.ino in the Arduino folder in the GitHub repository for Pheeno. To understand the calibration routine used in the following scripts, this is an Arduino script that will print out the accelerometer and magnetometer values. This script should be used if the EEPROM can no longer store information, to understand how the calibration is done, or to get the magnetic north offset used in other scripts.</p>

<p>Once uploading the script do not unplug the USB cord from the computer. Turn on the robot and open the serial monitor in the Arduino software. There should be numbers scrolling across the screen like in Figure <a href="pheeno_programming_content#fig3">3</a>. The first set of numbers under the “Magnetometer!” line are two vectors of the min and max readings of the magnetometer along the {x, y, z} axis. The second set of numbers under “Accelerometer!” are the averaged accelerometer measurements along the x, y, z axis. The last set of numbers under “Orientation!” is the current direction the robot has measured facing with respect to magnetic north (in degrees!).</p>

<p>To use this script,  place the robot where the experiment will take place without disconnecting it from the computer. Turn on the robot, open the serial monitor, and let it sit still for a period of time. During this time the accelerometer values are being averaged. These values will be non zero due to the natural slant of the ground or the orientation of the IMU mounted in the Pheeno robot. After a good amount of time has passed (~30 seconds), record the accelerometer values. These will be the biases you subtract off your readings to get an unbiased reading during your experiments. Next pick up Pheeno and rotate the robot about its three axis. Do this several times. When you place it back on the ground you should notice the vectors under the Magnetometer have changed. Record these values. These are the max and min values of the magnetic field in your experimental space and allow for Pheeno to better predict its heading with respect to magnetic north. The orientation in this script is just to give an idea on how well the compass is calibrated with default values. Spin Pheeno 90 degrees and see if the angle does change by about 90 degrees.</p>

<p>Now that you have recorded the values open <em>ManualInputEEPROM.ino</em>. This script writes the values you have recorded to the EEPROM of the Arduino. The EEPROM of the Arduino is like a mini hard drive where you can save data that won’t be erased when the power to the robot is lost (very useful for calibration data!). Insert the data you have written down in the correct spots of the code (described below).</p>

<figure id="fig3">
    <center>
        <img src="http://localhost:4000/images/programming/ManualCalibrationSerial.jpg" width="450" height="500" />
    </center>
</figure>
<p><strong><em>Figure 3:</em></strong> <em>The serial output of the CalibrateIMU script.</em></p>

<p>This paragraph briefly describes the <em>ManualVluesIMU.ino</em> code shown below. Lines 2 and 3 import the correct libraries used to get data from the LSM303D IMU onboard the robot. Lines 6 and 7 set up the LSM303 library for the rest of the script creating two vectors to store the max and min values for the magnetometer. Lines 9 to 11 contain variables that store the acceleration mean values. Line 13 creates a counter to help with the acceleration means. The setup first starts the serial port with a bit rate of 9600. Then sets up the two libraries that were imported. Line 25 increments the count variable. Line 26 gets new updated data from the LSM303D. Lines 30 to 36 update the min and max values of the magnetometer vector. Lines 40 to 42 update the mean of the acceleration variables. Lines 45 to 59 simply format and perform the prints that occurs through the serial.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script is used to calibrate the Pheeno robot's IMU. Instructions for use can be found in the Pheeno Robot Programming Guide.
*/</span>

<span class="n">include</span> <span class="s">"Wire.h"</span>
<span class="n">include</span> <span class="s">"LSM303.h"</span>

<span class="n">LSM303</span> <span class="n">compass</span><span class="p">;</span>
<span class="n">LSM303</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="o">&gt;</span> <span class="n">running_min</span> <span class="o">=</span> <span class="p">{</span><span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">};</span>
<span class="n">LSM303</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="o">&gt;</span> <span class="n">running_max</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">};</span>

<span class="kt">float</span> <span class="n">accX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">accY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">accZ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">char</span> <span class="n">report</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
    <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
    <span class="n">compass</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="n">compass</span><span class="p">.</span><span class="n">enableDefault</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  
    <span class="n">compass</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>

    <span class="c1">// Compass Max and Min
</span>    <span class="n">running_min</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">running_min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">running_min</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">running_min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">running_min</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">running_min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

    <span class="n">running_max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">running_max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">running_max</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">running_max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">running_max</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">running_max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

    <span class="c1">// Acceleration Mean
</span>    <span class="n">accX</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">accX</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">compass</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">accY</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">accY</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">compass</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">accZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">accZ</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">compass</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>


    <span class="n">snprintf</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">report</span><span class="p">),</span> <span class="s">"min: %+6d, %+6d, %+6d    max: %+6d, %+6d, %+6d"</span><span class="p">,</span>
    <span class="n">running_min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span>
    <span class="n">running_max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Magnetometer!"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">report</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Accelerometer!"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">accX</span><span class="p">));</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">accY</span><span class="p">));</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">accZ</span><span class="p">));</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Orientation!"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="n">compass</span><span class="p">.</span><span class="n">heading</span><span class="p">());</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
</div>

<p>This paragraph briefly describes the <em>ManualValuesIMU.ino</em> code shown below. Lines 3 and 4 import the libraries used for storing the calibration data. Line 8 should have the values in the {} changed to the ones recorded in <em>ManualValuesIMU.ino</em>. These are your max and min magnetometer readings that are used to determine the robot’s orientation. Lines 11 to 13 should have their values changed to the accelerometer values recorded earlier. All the values entered above should be integers! The rest of the code simply stores all of these values into the EEPROM.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script is used to calibrate the Pheeno robot's IMU. Stores the values in the EEPROM.
*/</span>

<span class="n">include</span> <span class="s">"LSM303.h"</span>
<span class="n">include</span> <span class="s">"EEPROM.h"</span>

<span class="n">LSM303</span> <span class="n">compass</span><span class="p">;</span>
<span class="c1">// Input Compass Values Here!
</span><span class="n">LSM303</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="o">&gt;</span> <span class="n">running_min</span> <span class="o">=</span> <span class="p">{</span><span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">},</span> <span class="n">running_max</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">};</span>

<span class="c1">// Input Accelerometer Values Here!
</span><span class="kt">int</span> <span class="n">accX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">accY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">accZ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">eeAddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Store Values to the EEPROM
</span>    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">accX</span><span class="p">));</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">accY</span><span class="p">));</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">accZ</span><span class="p">));</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="c1">// Store Values to the EEPROM
</span>    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="c1">// Store Values to the EEPROM
</span>    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="eeprom-automatic-calibration">EEPROM Automatic Calibration</h3>
<p>To calibrate Pheeno automatically, open the script <em>AutomaticCalibrateIMU.ino</em> in the Arduino folder in the GitHub repository for Pheeno. This script does essentially what the manual script described above does(<a href="pheeno_programming_content#manual-calibration">“Manual Calibration”</a> section). To use this calibration program, upload the script then place Pheeno in the arena you wish to run the experiment in. Turn on the robot, it should sit still for about a minute then rotate for another minute. Once it has stopped moving it should be calibrated!</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script is used to calibrate the Pheeno robot's IMU. Stores the values in the EEPROM.
*/</span>

<span class="n">include</span> <span class="o">&lt;</span><span class="n">Wire</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="n">include</span> <span class="o">&lt;</span><span class="n">LSM303</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="n">include</span> <span class="o">&lt;</span><span class="n">EEPROM</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>

<span class="n">LSM303</span> <span class="n">compass</span><span class="p">;</span>
<span class="n">LSM303</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="o">&gt;</span> <span class="n">running_min</span> <span class="o">=</span> <span class="p">{</span><span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">,</span> <span class="mi">32767</span><span class="p">},</span> <span class="n">running_max</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">};</span>

<span class="kt">float</span> <span class="n">accX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">accY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">accZ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">eeAddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">///////////////////////////////////////////////////////////
// Pin Numbers Here
///////////////////////////////////////////////////////////
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">IRC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// Analog input center sensor
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">IRLF</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Analog input left forward sensor
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">IRL</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">// Analog input left sensor
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">IRB</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// Analog input back sensor
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">IRRF</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// Analog input right forward sensor
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">IRR</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>  <span class="c1">// Analog input right sensor
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">PWMA</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="c1">// A Motor PWM Control
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">PWMB</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>  <span class="c1">// B Motor PWM Control
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">AMotor1</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>  <span class="c1">// A Motor Direction 1
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">AMotor2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// A Motor Direction 2
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">BMotor1</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="c1">// B Motor Direction 1
</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">BMotor2</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// B Motor Direction 2
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">STBY</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// Standby pin to turn off motors.
</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">interruptL</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">interruptR</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">noInterruptL</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">noInterruptR</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
    <span class="n">compass</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="n">compass</span><span class="p">.</span><span class="n">enableDefault</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">compass</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>

        <span class="c1">// Acceleration Mean
</span>        <span class="n">accX</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">accX</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">compass</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">accY</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">accY</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">compass</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="n">accZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">accZ</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">count</span> <span class="o">*</span> <span class="n">compass</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  
    <span class="p">}</span>

    <span class="c1">// Store Values to the EEPROM
</span>    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">accX</span><span class="p">));</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">accY</span><span class="p">));</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">accZ</span><span class="p">));</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="n">turnRight</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>  
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
        <span class="n">compass</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>

        <span class="c1">// Compass Max and Min  
</span>        <span class="n">running_min</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">running_min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">running_min</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">running_min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">running_min</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">running_min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

        <span class="n">running_max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">running_max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">running_max</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">running_max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">running_max</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">running_max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">compass</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Store Values to the EEPROM
</span>    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_min</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="c1">// Store Values to the EEPROM
</span>    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="n">EEPROM</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">eeAddress</span><span class="p">,</span> <span class="n">running_max</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="n">eeAddress</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">){</span>
        <span class="n">noMotion</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">noMotion</span><span class="p">(){</span>
    <span class="c1">// Turns the motors off. (They can still rotate passively)
</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">STBY</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span> <span class="c1">// Motors OFF
</span><span class="p">}</span>

<span class="kt">void</span> <span class="n">forwardL</span><span class="p">(</span><span class="kt">int</span> <span class="n">motorSpeed</span><span class="p">){</span>
    <span class="c1">// Left motor drive forward.  
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">motorSpeed</span><span class="o">&gt;</span><span class="mi">255</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">motorSpeed</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">motorSpeed</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">motorSpeed</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">STBY</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span> <span class="c1">// Motors ON
</span>    <span class="n">analogWrite</span><span class="p">(</span><span class="n">PWMA</span><span class="p">,</span> <span class="n">motorSpeed</span><span class="p">);</span> <span class="c1">// Speed
</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">AMotor1</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>    
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">AMotor2</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">reverseR</span><span class="p">(</span><span class="kt">int</span> <span class="n">motorSpeed</span><span class="p">){</span>
    <span class="c1">// Right motor drive backwards.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">motorSpeed</span><span class="o">&gt;</span><span class="mi">255</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">motorSpeed</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">motorSpeed</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">motorSpeed</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">STBY</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span> <span class="c1">// Motors ON
</span>    <span class="n">analogWrite</span><span class="p">(</span><span class="n">PWMB</span><span class="p">,</span> <span class="n">motorSpeed</span><span class="p">);</span> <span class="c1">// Speed
</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">BMotor1</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>    
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">BMotor2</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>   
<span class="p">}</span>

<span class="kt">void</span> <span class="n">turnRight</span><span class="p">(</span><span class="kt">int</span> <span class="n">motorSpeed</span><span class="p">){</span>
    <span class="n">reverseR</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
    <span class="n">forwardL</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>  
<span class="p">}</span>
</code></pre>
</div>

<h3 id="checking-the-eeprom-calibration">Checking the EEPROM Calibration</h3>
<p>If you want to make sure the calibration information was stored correctly, open the <em>EEPROMReadCalibrateData.ino</em> script. Upload it to Pheeno and keep the robot connected to the computer. You do not need to turn on the robot as the computer can power the Arduino. If you open the serial monitor in the Arduino software, you should see a printout like the one seen in Figure <a href="pheeno_programming_content#fig4">4</a>. The numbers should be integers (definitely) and non-zero (most likely). If not something in the calibration has gone wrong.</p>

<figure id="fig4">
    <center>
        <img src="http://localhost:4000/images/programming/CalibrationData.jpg" width="500" height="500" />
    </center>
</figure>
<p><strong><em>Figure 4:</em></strong> <em>The serial output of the EEPROMReadCalibrateData.ino script.</em></p>

<h2 id="pheeno-arduino-examples">Pheeno Arduino Examples</h2>
<p>This section describes the specific Arduino examples below. To open any of the examples below, open the Arduino software then navigate to <em>File</em> –&gt; <em>Examples</em> –&gt; <em>Pheeno</em> –&gt; <em>EXAMPLE</em>.</p>

<h3 id="openloopmotionexampleino">OpenLoopMotionExample.ino</h3>
<p>This code is meant as an intro to making Pheeno move around using <em>open loop</em> motor functions. Here <em>open loop</em> just means there is no check to make sure the wheels are doing what you want them to. When this script is uploaded to Pheeno and it is turned on it should drive forward, turn right, turn left, then drive backwards and stop. It should (in theory) start and stop at the same location. However, in reality this will not be the case the longer it runs.</p>

<p>Lines 4 and 5 are just the normal includes that are needed when using the Pheeno library. The setup uses the standard Pheeno library setup to initialize pins correctly and start timers. Inside the loop are where all the functions occur. To drive the robot forward, line 13 uses Pheeno.forward(150). This causes both wheels on the robot to spin forward. The 150 argument can be thought of as a speed. The argument in these parenthesis is an Arduino PWM integer ranging from 0-255 where 0 is stopped and 255 is the fastest the robot can go. Once this argument is given, the wheels will continue to spin this way until a different command is given. The delay(5000) on line 14 keeps any other functions from being called for 5000 ms (5 seconds). This means the robot will drive forward for 5 seconds. <font color="red">NOTE: BE VERY CAREFUL WHEN USING DELAYS IN OTHER CODE, THEY STOP EVERYTHING IN THE SCRIPT MEANING NO SENSORS CAN BE READ AND CONTROLLERS WILL NOT BE UPDATED!</font>. The rest of the script follows a similar pattern to cause the robot to turn right and left, then back up and stop. Since this is in a loop, this will keep repeating until you turn the robot off or upload a different code.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script gives an introduction to making Pheeno drive open loop. There is no feedback, motors move at the given input but can be prone to errors in manufacturing and environment. Everything will be done with delays, however, it should be noted you cannot use delays  if you require sensor feedback.
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import this!
</span><span class="cp">#include "Pheeno.h"
</span><span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
    <span class="c1">// This must be included in every script! It sets up all the pins on the robot!
</span>  <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">myRobot</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>   <span class="c1">// Pheeno drives forward.
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>              <span class="c1">// Wait for 5 seconds
</span>  <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="mi">70</span><span class="p">);</span>  <span class="c1">// Pheeno turns right.
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>              <span class="c1">// Wait for 2 seconds.
</span>  <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="mi">70</span><span class="p">);</span>   <span class="c1">// Pheeno rotates left.
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>              <span class="c1">// Wait for 2 seconds.
</span>  <span class="n">myRobot</span><span class="p">.</span><span class="n">reverse</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>   <span class="c1">// Pheeno drives backwards.
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>              <span class="c1">// Wait for 5 seconds
</span>  <span class="n">myRobot</span><span class="p">.</span><span class="n">brake</span><span class="p">();</span>        <span class="c1">// Brake the motors.
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>              <span class="c1">// Wait for 3 seconds.
</span><span class="p">}</span>
</code></pre>
</div>

<h3 id="pidmotorcontrolexample">PIDMotorControlExample</h3>

<p>Now if you want some <em>feedback</em> when using the motors, this script uses a function that actually checks if the motors are moving at the speed you have given to them. Lines 4 and 6 import the libraries needed to use the Pheeno library. Line 8 sets the desired velocity you want the robot to move at. This is in cm/s and can be changed to move the robot slower or faster. Line 12 converts the linear velocity to a rotational one that the controller acts on. The setup uses the standard setup and the loop uses the PIDMotorControl function described in the <a href="pheeno_programming_content#pidmotorcontrolfloat-deslvel-float-desrvel">“PIDMotorControl”</a> section.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script gives an introduction to using encoder feedback on Pheeno's motors. In this code we will make Pheeno drive straight at a given velocity. A premade PID controller has been made to control the individual motor speeds and can be accessed using the Pheeno.PIDMotorControl() function. The PID feedback relies solely on the encoders so wheel slip can cause to robot to diverge from a straight line path! The gains of the PID can be adjusted in the Pheeno.cpp file.
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import this!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// The linear velocity we want the robot to go in cm/s
</span><span class="kt">float</span> <span class="n">desVel</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">// This must be included in every script! It sets up all the pins on the
</span>  <span class="c1">// robot!
</span>  <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
  <span class="c1">// Converts the linear velocity to rotational velocity for the controller.
</span>  <span class="n">desVel</span> <span class="o">=</span> <span class="n">desVel</span> <span class="o">*</span> <span class="mi">2</span><span class="o">/</span><span class="n">myRobot</span><span class="p">.</span><span class="n">wheelDiameter</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">myRobot</span><span class="p">.</span><span class="n">PIDMotorControl</span><span class="p">(</span><span class="n">desVel</span><span class="p">,</span> <span class="n">desVel</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="randomwalkexample">RandomWalkExample</h3>

<p>The random walk example simply makes the robot move around in a random walk.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script gives an introduction to making Pheeno drive a random walk. It uses delays and Arduino PWM units (int, 0-255) for speed.
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import these libraries!!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// This must be included in every script! It sets up all the pins on the
</span>    <span class="c1">// robot!
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
    <span class="c1">// Randomly generate the ms of delay for the turn.
</span>    <span class="kt">float</span> <span class="n">turnDelayTime</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">){</span>
        <span class="c1">// The arduino random function is inclusive on the lower bound and
</span>        <span class="c1">// exclusive on the upper bound. Thus this randomly generates 0 and 1
</span>        <span class="c1">// and creates a coin flip whether to move left or right.
</span>
        <span class="c1">// Pheeno rotates left about its center at a given speed
</span>        <span class="c1">// (range 0 to 255).
</span>        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
        <span class="c1">// Wait a random amount of time defined above.
</span>        <span class="n">delay</span><span class="p">(</span><span class="n">turnDelayTime</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Pheeno rotates right about its center at a given speed
</span>        <span class="c1">// (range 0 to 255).
</span>        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
        <span class="c1">// Wait a random amount of time defined above.
</span>        <span class="n">delay</span><span class="p">(</span><span class="n">turnDelayTime</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ms of delay for the run (you can make this random if you desire!).
</span>    <span class="kt">float</span> <span class="n">runDelayTime</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="c1">// Pheeno moves forward at a given speed (range 0 to 255).
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">120</span><span class="p">);</span>
    <span class="c1">// Wait a random amount of time defined above.
</span>    <span class="n">delay</span><span class="p">(</span><span class="n">runDelayTime</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="serialprintsensors">SerialPrintSensors</h3>
<p>This reads all the sensors on the robot and prints them out through the serial port. To use this, upload this script to the robot, turn on the robot, then, while the robot is still attached to the computer, open the serial monitor. The sensor values should be output.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script constantly reads Pheeno's onboard sensors and prints their results through the serial port.
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import this!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// A delay time to make manually reading the serial port easier!
</span><span class="kt">float</span> <span class="n">delayTime</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
    <span class="c1">// Starts the serial port, with the argument being the bit rate.
</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
    <span class="c1">// This must be included in every script! It sets up all the pins on the
</span>    <span class="c1">// robot!
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"A test read of all Pheeno's sensors!"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Reads all of the IR sensor distances in cm.
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">readIR</span><span class="p">();</span>
    <span class="c1">// Reads how many total ticks have occured on the encoders.
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">readEncoders</span><span class="p">();</span>
    <span class="c1">// Reads the compass. The argument is the offset between your global x-axis
</span>    <span class="c1">// and magnetic north.
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">readCompass</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// Reads the accelerometer.
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">readAccel</span><span class="p">();</span>  

    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"IR Sensor Distances!"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"[Left IR, Left Forward IR, Center IR, Right Forward IR, Right IR, Back IR]"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"["</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">LDistance</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">LFDistance</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">CDistance</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RFDistance</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RDistance</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">BDistance</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"]"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Encoder Counts!"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"[Left Encoder, Right Encoder]"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"["</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">encoderCountL</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">encoderCountR</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"]"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"IMU Measurements (Accelerometer and Magnetometer/Compass)!"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"[X Acceleration, Y Acceleration, Z Acceleration, Heading]"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"["</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">IMUACCX</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">IMUACCY</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">IMUACCZ</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">IMUOrientation</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"]"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>

    <span class="c1">// A simple delay to make manual reading of the serail port easier.
</span>    <span class="n">delay</span><span class="p">(</span><span class="n">delayTime</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="drivecircleexample">DriveCircleExample</h3>
<p>This example causes Pheeno to drive in a circle of radius <em>R</em> such that it traverses the circle at <em>w</em> rad/s.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script gives an introduction to making Pheeno turn with encoder feedback. This uses the same PID controller as PIDMotorControlExample. In this example Pheeno will drive in a circle of radius R at angular speed w.
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import this!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">//The angular velocity Pheeno will traverse the circle (rad/s)! CCW direction
// is positive velocity!
</span><span class="kt">float</span> <span class="n">desW</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">;</span>
<span class="c1">// The radius of the circle Pheeno will be on (cm).
</span><span class="kt">float</span> <span class="n">R</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
    <span class="c1">// This must be included in every script! It sets up all the pins on the
</span>    <span class="c1">// robot!
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
    <span class="c1">// The inputs to this function are: (Desired Radius (cm), Desired Angular
</span>    <span class="c1">// Velocity (rad/s)).
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">rotateAboutICC</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">desW</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="randomwalkobstacleavoidexample">RandomWalkObstacleAvoidExample</h3>
<p>This function does the same random walk as done in the <a href="pheeno_programming_content#randomwalkexample">RandomWalkExample</a> section but does not use delays so it can read the IR range sensors to avoid obstacles during the walk.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script gives an introduction to making Pheeno drive a random walk. While doing the random walk, it will avoid obstacles.
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import these libraries!!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Distance in CM at which Pheeno will avoid obstacles.
</span><span class="kt">float</span> <span class="n">rangeToAvoid</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="c1">// Compare time in ms we will base our while loops off of. Initialized in the
// set up!
</span><span class="kt">float</span> <span class="n">compareTime</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
    <span class="c1">// This must be included in every script! It sets up all the pins on the
</span>    <span class="c1">// robot!
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
    <span class="c1">// Compare time in ms we will base our while loops off of.
</span>    <span class="n">compareTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
    <span class="c1">// Randomly generate the ms of delay for the turn.
</span>    <span class="kt">float</span> <span class="n">turnDelayTime</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">){</span>
        <span class="c1">// The arduino random function is inclusive on the lower bound and
</span>        <span class="c1">// exclusive on the upper bound. Thus this randomly generates 0 and 1
</span>        <span class="c1">// and creates a coin flip whether to move left or right.
</span>
        <span class="c1">// Pheeno rotates left about its center at a given speed
</span>        <span class="c1">// (range 0 to 255).
</span>        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
        <span class="c1">// Wait a random amount of time defined above.
</span>        <span class="k">while</span><span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">compareTime</span> <span class="o">&lt;</span> <span class="n">turnDelayTime</span><span class="p">){</span>
            <span class="n">avoidObstacles</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">compareTime</span><span class="o">=</span><span class="n">millis</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Pheeno rotates right about its center at a given speed
</span>        <span class="c1">// (range 0 to 255).
</span>        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
        <span class="c1">// Wait a random amount of time defined above.
</span>        <span class="k">while</span><span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">compareTime</span> <span class="o">&lt;</span> <span class="n">turnDelayTime</span><span class="p">){</span>
            <span class="n">avoidObstacles</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">compareTime</span><span class="o">=</span><span class="n">millis</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ms of delay for the run (you can make this random if you desire!).
</span>    <span class="kt">float</span> <span class="n">runDelayTime</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="c1">// Pheeno moves forward at a given speed (range 0 to 255).
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">120</span><span class="p">);</span>
    <span class="c1">// Wait a random amount of time defined above.
</span>    <span class="k">while</span><span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">compareTime</span> <span class="o">&lt;</span> <span class="n">runDelayTime</span><span class="p">){</span>
        <span class="n">avoidObstacles</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">compareTime</span><span class="o">=</span><span class="n">millis</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">avoidObstacles</span><span class="p">(){</span>
    <span class="n">myRobot</span><span class="p">.</span><span class="n">readIR</span><span class="p">();</span>
    <span class="c1">// Speed at which to rotate away from collisions (In arduino PWM units
</span>    <span class="c1">// (int, 0 to 255)).
</span>    <span class="kt">int</span> <span class="n">collisionRotateSpeed</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">CDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">((</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RDistance</span> <span class="o">-</span> <span class="n">myRobot</span><span class="p">.</span><span class="n">LDistance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RDistance</span> <span class="o">&gt;</span> <span class="n">rangeToAvoid</span> <span class="o">&amp;&amp;</span> <span class="n">myRobot</span><span class="p">.</span><span class="n">LDistance</span> <span class="o">&gt;</span> <span class="n">rangeToAvoid</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RDistance</span> <span class="o">&lt;</span> <span class="n">myRobot</span><span class="p">.</span><span class="n">LDistance</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RFDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span> <span class="o">&amp;&amp;</span> <span class="n">myRobot</span><span class="p">.</span><span class="n">LFDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">){</span>
            <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RFDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">LFDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">LDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnRight</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">RDistance</span> <span class="o">&lt;</span> <span class="n">rangeToAvoid</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">myRobot</span><span class="p">.</span><span class="n">turnLeft</span><span class="p">(</span><span class="n">collisionRotateSpeed</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="waypointencoders">WayPointEncoders</h3>
<p>This script makes Pheeno drive a square of side 75 cm. It uses encoder feedback to determine its global position. If you wish Pheeno to drive to different way points simply change the array in lines 13 and 14.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script makes Pheeno drive to different way points using only encoder feedback!
*/</span>

<span class="c1">// If you want to use Pheeno's premade routines import this!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Time step for the odometry update to operate at (10Hz)!
</span><span class="kt">float</span> <span class="n">timeStep</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="c1">// Iterator through the way points.
</span><span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// Desired linear velocity of Pheeno in cm/s.
</span><span class="kt">float</span> <span class="n">desVel</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// --- WayPoint Path Points ---
// Pheeno's array of waypoint x positions.
</span><span class="kt">float</span> <span class="n">botYf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">75.0000</span><span class="p">,</span><span class="mf">75.00</span><span class="p">};</span>
<span class="c1">// Pheeno's array of waypoint y positions.
</span><span class="kt">float</span> <span class="n">botXf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mf">75.0000</span><span class="p">,</span><span class="mf">75.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>

<span class="c1">//Number of waypoints entered.
</span><span class="kt">int</span> <span class="n">numWayPoints</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">botXf</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
    <span class="c1">//This must be included in every script! It sets up all the pins on the
</span>    <span class="c1">// robot!
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">calculateDistance</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">botXPos</span><span class="p">,</span><span class="n">myRobot</span><span class="p">.</span><span class="n">botYPos</span><span class="p">,</span> <span class="n">botXf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">],</span> <span class="n">botYf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">){</span>
        <span class="n">myRobot</span><span class="p">.</span><span class="n">PIDWayPointControl</span><span class="p">(</span><span class="n">botXf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">],</span><span class="n">botYf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">],</span><span class="n">desVel</span><span class="p">,</span><span class="n">timeStep</span><span class="p">);</span>
        <span class="c1">// Encoders used for state estimates.
</span>        <span class="n">myRobot</span><span class="p">.</span><span class="n">encoderPositionUpdate</span><span class="p">(</span><span class="n">timeStep</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">count</span> <span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">calculateDistance</span><span class="p">(</span><span class="kt">float</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y2</span><span class="p">){</span>
    <span class="c1">//Calculates the distance the robot is from the desired way point
</span>    <span class="kt">float</span> <span class="n">space</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sq</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span> <span class="o">+</span> <span class="n">sq</span><span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)));</span>
    <span class="k">return</span> <span class="n">space</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="waypointsensorfusion">wayPointSensorFusion</h3>

<p>This also makes Pheeno drive in a square of side 75 cm but uses a complementary filter for sensor fusion for updating the robots global position. The robot should be calibrated before this script is run!</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
This script makes Pheeno drive to different way points using a complementary filter on the magnetometer, accelerometer, and encoders for feedback!
*/</span>


<span class="c1">// If you want to use Pheeno's premade routines import this!
</span><span class="cp">#include "Pheeno.h"
</span>
<span class="c1">// The argument is the type of robot (0 = Original DD, 1 = Tank Treads,
// 2 = Tripod DD)
</span><span class="n">Pheeno</span> <span class="n">myRobot</span> <span class="o">=</span> <span class="n">Pheeno</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Time step for the odometry update to operate at (10Hz)!
</span><span class="kt">float</span> <span class="n">timeStep</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="c1">// Iterator through the way points.
</span><span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// Desired linear velocity of Pheeno in cm/s.
</span><span class="kt">float</span> <span class="n">desVel</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="c1">// Difference between magnetic north and the global X axis
</span><span class="kt">float</span> <span class="n">northOffset</span> <span class="o">=</span> <span class="mf">12.9</span><span class="p">;</span>

<span class="c1">// --- WayPoint Path Points ---
// Pheeno's array of waypoint x positions.
</span><span class="kt">float</span> <span class="n">botYf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">75.0000</span><span class="p">,</span><span class="mf">75.00</span><span class="p">};</span>
<span class="c1">// Pheeno's array of waypoint y positions.
</span><span class="kt">float</span> <span class="n">botXf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mf">75.0000</span><span class="p">,</span><span class="mf">75.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>

<span class="c1">// Number of waypoints entered.
</span><span class="kt">int</span> <span class="n">numWayPoints</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">botXf</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
    <span class="c1">// This must be included in every script! It sets up all the pins on the
</span>    <span class="c1">// robot!
</span>    <span class="n">myRobot</span><span class="p">.</span><span class="n">SETUP</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">calculateDistance</span><span class="p">(</span><span class="n">myRobot</span><span class="p">.</span><span class="n">botXPos</span><span class="p">,</span><span class="n">myRobot</span><span class="p">.</span><span class="n">botYPos</span><span class="p">,</span><span class="n">botXf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">],</span><span class="n">botYf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">){</span>
        <span class="n">myRobot</span><span class="p">.</span><span class="n">PIDWayPointControl</span><span class="p">(</span><span class="n">botXf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">],</span><span class="n">botYf</span><span class="p">[</span><span class="n">count</span><span class="o">%</span><span class="n">numWayPoints</span><span class="p">],</span><span class="n">desVel</span><span class="p">,</span><span class="n">timeStep</span><span class="p">);</span>
        <span class="c1">// Encoders used for state estimates.
</span>        <span class="n">myRobot</span><span class="p">.</span><span class="n">sensorFusionPositionUpdate</span><span class="p">(</span><span class="n">timeStep</span><span class="p">,</span> <span class="n">northOffset</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">count</span> <span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">calculateDistance</span><span class="p">(</span><span class="kt">float</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y2</span><span class="p">){</span>
    <span class="c1">// Calculates the distance the robot is from the leader
</span>    <span class="kt">float</span> <span class="n">space</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sq</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span> <span class="o">+</span> <span class="n">sq</span><span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)));</span>
    <span class="k">return</span> <span class="n">space</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
